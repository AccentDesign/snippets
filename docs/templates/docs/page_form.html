{% extends 'base.html' %}
{% load app_tags i18n static %}
{% block page_title %}{% if object.id %}Update{% else %}Create{% endif %} Page{% endblock %}
{% block body_class %}page-form{% endblock %}
{% block inner_content %}
    <div class="container content">
        <h2>{% if object.id %}Update{% else %}Create{% endif %} Page</h2>
        {% if object.id %}<p>Created: {{ object.created_on }}</p>{% endif %}
        <form class="form" method="post" novalidate>
            {% csrf_token %}

            {% for field in form %}
                {% include 'partials/form_field.html' %}
            {% endfor %}

            {{ formset.management_form }}

            {% for formset_form in formset.forms %}
                <div class="formset{% if formset_form.DELETE.value %} deleted{% endif %}">
                    {% for field in formset_form.hidden_fields %}{{ field }}{% endfor %}
                    {% include 'partials/form_field.html' with field=formset_form.content %}
                    <div class="row">
                        <div class="col-md-6">{% include 'partials/form_field.html' with field=formset_form.snippet %}</div>
                        <div class="col-md-6">{% include 'partials/form_field.html' with field=formset_form.order %}</div>
                    </div>
                    <label class="button button-cinnabar" for="{{ formset_form.DELETE.id_for_label }}">
                        {{ formset_form.DELETE|addcss:'d-hidden' }} Remove
                    </label>
                </div>
            {% endfor %}

            {% with empty_form=formset.empty_form %}
                <div class="formset empty-form">
                    {% for field in empty_form.hidden_fields %}{{ field }}{% endfor %}
                    {% include 'partials/form_field.html' with field=empty_form.content %}
                    <div class="row">
                        <div class="col-md-6">{% include 'partials/form_field.html' with field=empty_form.snippet %}</div>
                        <div class="col-md-6">{% include 'partials/form_field.html' with field=empty_form.order %}</div>
                    </div>
                </div>
            {% endwith %}

            <input type="submit" class="button button-primary pull-right" value="Save Page">
            <a class="button" onclick="cloneFormsetRow('.empty-form', 'content_items');">Add Another Section</a>
        </form>
    </div>
{% endblock %}

{% block extra_js %}
    {{ form.media }}
    {{ formset.media }}
    <script src="{% static 'dist/js/form-tools.js' %}"></script>
{% endblock %}